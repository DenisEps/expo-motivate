{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"/Users/d_kuprin/expo-motivate/client/src/components/Auth/AuthForm/index.js\";\nimport React, { useState, useEffect } from \"react\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport ActivityIndicator from \"react-native-web/dist/exports/ActivityIndicator\";\nimport { Input, Button, Layout, Text } from \"@ui-kitten/components\";\nimport { useDispatch } from \"react-redux\";\nimport { userAuth, deleteUser } from \"../../../redux/actions\";\nimport TestDb from \"../../TestDb/TestDb\";\nimport { firebase } from \"../../../../firebase\";\nimport \"@firebase/firestore\";\nimport \"@firebase/auth\";\nimport * as Google from \"expo-google-app-auth\";\nimport AsyncStorage from \"@react-native-community/async-storage\";\nvar provider = new firebase.auth.GoogleAuthProvider();\n\nvar AuthForm = function AuthForm() {\n  var _useState = useState(\"\"),\n      _useState2 = _slicedToArray(_useState, 2),\n      email = _useState2[0],\n      setEmail = _useState2[1];\n\n  var _useState3 = useState(\"\"),\n      _useState4 = _slicedToArray(_useState3, 2),\n      pass = _useState4[0],\n      setPass = _useState4[1];\n\n  var _useState5 = useState(null),\n      _useState6 = _slicedToArray(_useState5, 2),\n      err = _useState6[0],\n      setError = _useState6[1];\n\n  var _useState7 = useState(false),\n      _useState8 = _slicedToArray(_useState7, 2),\n      test = _useState8[0],\n      setTest = _useState8[1];\n\n  var _useState9 = useState(null),\n      _useState10 = _slicedToArray(_useState9, 2),\n      userStore = _useState10[0],\n      setUserStore = _useState10[1];\n\n  var dispatch = useDispatch();\n\n  var save = function save(user) {\n    var objectValue, error;\n    return _regeneratorRuntime.async(function save$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            objectValue = JSON.stringify(user);\n            _context.next = 4;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem(\"user\", objectValue));\n\n          case 4:\n            _context.next = 10;\n            break;\n\n          case 6:\n            _context.prev = 6;\n            _context.t0 = _context[\"catch\"](0);\n            error = new Error(_context.t0);\n            setError(error.message);\n\n          case 10:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 6]], Promise);\n  };\n\n  var remove = function remove() {\n    var error;\n    return _regeneratorRuntime.async(function remove$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            _context2.next = 3;\n            return _regeneratorRuntime.awrap(AsyncStorage.removeItem(\"user\"));\n\n          case 3:\n            _context2.next = 9;\n            break;\n\n          case 5:\n            _context2.prev = 5;\n            _context2.t0 = _context2[\"catch\"](0);\n            error = new Error(_context2.t0);\n            setError(error.message);\n\n          case 9:\n            _context2.prev = 9;\n            setUserStore(\"\");\n            return _context2.finish(9);\n\n          case 12:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[0, 5, 9, 12]], Promise);\n  };\n\n  var Login = function Login() {\n    var user, uid, us, error;\n    return _regeneratorRuntime.async(function Login$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.prev = 0;\n            _context3.next = 3;\n            return _regeneratorRuntime.awrap(firebase.auth().signInWithEmailAndPassword(email, pass));\n\n          case 3:\n            user = _context3.sent;\n            _context3.next = 6;\n            return _regeneratorRuntime.awrap(firebase.auth().currentUser.uid);\n\n          case 6:\n            uid = _context3.sent;\n            _context3.next = 9;\n            return _regeneratorRuntime.awrap(firebase.auth().currentUser);\n\n          case 9:\n            us = _context3.sent;\n            _context3.next = 12;\n            return _regeneratorRuntime.awrap(firebase.firestore().collection(\"users\").doc(uid).get().then(function (info) {\n              return save(info.data());\n            }));\n\n          case 12:\n            setEmail(\"\");\n            setPass(\"\");\n            setTest(true);\n            dispatch(userAuth(true));\n            _context3.next = 22;\n            break;\n\n          case 18:\n            _context3.prev = 18;\n            _context3.t0 = _context3[\"catch\"](0);\n            error = new Error(_context3.t0);\n            setError(error.message);\n\n          case 22:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, [[0, 18]], Promise);\n  };\n\n  var logout = function logout() {\n    var user;\n    return _regeneratorRuntime.async(function logout$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            dispatch(deleteUser());\n            remove();\n            _context4.next = 4;\n            return _regeneratorRuntime.awrap(firebase.auth().signOut());\n\n          case 4:\n            user = firebase.auth().currentUser;\n            return _context4.abrupt(\"return\", user ? console.log(\"logout\", user) : console.log(\"signOut\"));\n\n          case 6:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var onSignIn = function onSignIn(googleUser) {\n    var unsubscribe = firebase.auth().onAuthStateChanged(function (firebaseUser) {\n      unsubscribe();\n\n      if (!isUserEqual(googleUser, firebaseUser)) {\n        var credential = firebase.auth.GoogleAuthProvider.credential(googleUser.idToken, googleUser.accessToken);\n        firebase.auth().signInWithCredential(credential).then(function _callee(user) {\n          var _userAuth, _userAuth2;\n\n          return _regeneratorRuntime.async(function _callee$(_context5) {\n            while (1) {\n              switch (_context5.prev = _context5.next) {\n                case 0:\n                  if (!user.additionalUserInfo.isNewUser) {\n                    _context5.next = 9;\n                    break;\n                  }\n\n                  console.log(\"USER>>>>>>>> true\", user.additionalUserInfo.isNewUser);\n                  _userAuth = user.user;\n                  _context5.next = 5;\n                  return _regeneratorRuntime.awrap(firebase.firestore().collection(\"users\").doc(user.user.uid).set({\n                    email: _userAuth.email == null ? \"\" : _userAuth.email,\n                    displayName: _userAuth.displayName == null ? \"\" : _userAuth.displayName,\n                    phoneNumber: _userAuth.phoneNumber == null ? \"\" : _userAuth.phoneNumber,\n                    photoURL: _userAuth.photoURL == null ? \"\" : _userAuth.photoURL,\n                    emailVerified: _userAuth.emailVerified == null ? \"\" : _userAuth.emailVerified\n                  }));\n\n                case 5:\n                  _context5.next = 7;\n                  return _regeneratorRuntime.awrap(firebase.firestore().collection(\"users\").doc(user.user.uid).get().then(function (info) {\n                    return save(info.data());\n                  }));\n\n                case 7:\n                  _context5.next = 15;\n                  break;\n\n                case 9:\n                  console.log(\"USER>>>>>>>> false\", user.additionalUserInfo.isNewUser);\n                  _userAuth2 = user.user;\n                  _context5.next = 13;\n                  return _regeneratorRuntime.awrap(firebase.firestore().collection(\"users\").doc(user.user.uid).update({\n                    email: _userAuth2.email == null ? \"\" : _userAuth2.email,\n                    displayName: _userAuth2.displayName == null ? \"\" : _userAuth2.displayName,\n                    phoneNumber: _userAuth2.phoneNumber == null ? \"\" : _userAuth2.phoneNumber,\n                    photoURL: _userAuth2.photoURL == null ? \"\" : _userAuth2.photoURL,\n                    emailVerified: _userAuth2.emailVerified == null ? \"\" : _userAuth2.emailVerified\n                  }));\n\n                case 13:\n                  _context5.next = 15;\n                  return _regeneratorRuntime.awrap(firebase.firestore().collection(\"users\").doc(user.user.uid).get().then(function (info) {\n                    return save(info.data());\n                  }));\n\n                case 15:\n                case \"end\":\n                  return _context5.stop();\n              }\n            }\n          }, null, null, null, Promise);\n        }).catch(function (error) {\n          var errorCode = error.code;\n          errorCode ? setError(errorCode) : null;\n          var errorMessage = error.message;\n          errorCode ? setError(errorMessage) : null;\n          var email = error.email;\n          errorCode ? setError(email) : null;\n          var credential = error.credential;\n          errorCode ? setError(credential) : null;\n          console.log(errorCode);\n          console.log(errorMessage);\n          console.log(email);\n          console.log(credential);\n        });\n      } else {\n        setError(\"User already signed-in Firebase.\");\n        console.log(\"User already signed-in Firebase.\");\n      }\n    });\n  };\n\n  var isUserEqual = function isUserEqual(googleUser, firebaseUser) {\n    if (firebaseUser) {\n      var providerData = firebaseUser.providerData;\n\n      for (var i = 0; i < providerData.length; i++) {\n        if (providerData[i].providerId === firebase.auth.GoogleAuthProvider.PROVIDER_ID && providerData[i].uid === googleUser.getBasicProfile().getId()) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  };\n\n  function signInWithGoogleAsync() {\n    var result, error;\n    return _regeneratorRuntime.async(function signInWithGoogleAsync$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            _context6.prev = 0;\n            _context6.next = 3;\n            return _regeneratorRuntime.awrap(Google.logInAsync({\n              behavior: \"web\",\n              iosClientId: \"531972357750-se0jv52p37gs986lcv4j8sma2crlom3i.apps.googleusercontent.com\",\n              scopes: [\"profile\", \"email\"]\n            }));\n\n          case 3:\n            result = _context6.sent;\n\n            if (!(result.type === \"success\")) {\n              _context6.next = 12;\n              break;\n            }\n\n            setError(null);\n            onSignIn(result);\n            setUserStore(result.user);\n            dispatch(userAuth(true));\n            return _context6.abrupt(\"return\", result.accessToken);\n\n          case 12:\n            return _context6.abrupt(\"return\", setError(\"Something went wrong\"));\n\n          case 13:\n            _context6.next = 19;\n            break;\n\n          case 15:\n            _context6.prev = 15;\n            _context6.t0 = _context6[\"catch\"](0);\n            error = new Error(_context6.t0);\n            return _context6.abrupt(\"return\", setError(error.message));\n\n          case 19:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, null, null, [[0, 15]], Promise);\n  }\n\n  return React.createElement(Layout, {\n    style: {\n      alignItems: \"center\",\n      top: 250\n    },\n    level: \"1\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 5\n    }\n  }, React.createElement(Input, {\n    style: {\n      width: \"75%\"\n    },\n    placeholder: \"Email\",\n    value: email,\n    onChangeText: function onChangeText(nextValue) {\n      return setEmail(nextValue);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 7\n    }\n  }), React.createElement(Input, {\n    style: {\n      width: \"75%\"\n    },\n    secureTextEntry: true,\n    placeholder: \"Password\",\n    value: pass,\n    onChangeText: function onChangeText(nextValue) {\n      return setPass(nextValue);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 7\n    }\n  }), React.createElement(Button, {\n    style: {\n      width: \"75%\",\n      marginBottom: 5\n    },\n    onPress: Login,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 7\n    }\n  }, \"Sugn In\"), React.createElement(Button, {\n    style: {\n      width: \"75%\",\n      marginBottom: 5\n    },\n    onPress: function onPress() {\n      return signInWithGoogleAsync();\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 7\n    }\n  }, \"Sign In With Google\"), React.createElement(Button, {\n    style: {\n      width: \"75%\",\n      marginBottom: 5\n    },\n    onPress: logout,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 254,\n      columnNumber: 7\n    }\n  }, \"Logout\"), test ? React.createElement(TestDb, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 15\n    }\n  }) : null, err ? React.createElement(Text, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 14\n    }\n  }, err) : null);\n};\n\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1\n  }\n});\nexport default AuthForm;","map":{"version":3,"sources":["/Users/d_kuprin/expo-motivate/client/src/components/Auth/AuthForm/index.js"],"names":["React","useState","useEffect","Input","Button","Layout","Text","useDispatch","userAuth","deleteUser","TestDb","firebase","Google","AsyncStorage","provider","auth","GoogleAuthProvider","AuthForm","email","setEmail","pass","setPass","err","setError","test","setTest","userStore","setUserStore","dispatch","save","user","objectValue","JSON","stringify","setItem","error","Error","message","remove","removeItem","Login","signInWithEmailAndPassword","currentUser","uid","us","firestore","collection","doc","get","then","info","data","logout","signOut","console","log","onSignIn","googleUser","unsubscribe","onAuthStateChanged","firebaseUser","isUserEqual","credential","idToken","accessToken","signInWithCredential","additionalUserInfo","isNewUser","set","displayName","phoneNumber","photoURL","emailVerified","update","catch","errorCode","code","errorMessage","providerData","i","length","providerId","PROVIDER_ID","getBasicProfile","getId","signInWithGoogleAsync","logInAsync","behavior","iosClientId","scopes","result","type","alignItems","top","width","nextValue","marginBottom","styles","StyleSheet","create","container","flex"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { StyleSheet, ActivityIndicator } from \"react-native\";\nimport { Input, Button, Layout, Text } from \"@ui-kitten/components\";\nimport { useDispatch } from \"react-redux\";\nimport { userAuth, deleteUser } from \"../../../redux/actions\";\nimport TestDb from \"../../TestDb/TestDb\";\nimport { firebase } from \"../../../../firebase\";\nimport \"@firebase/firestore\";\nimport \"@firebase/auth\";\nimport * as Google from \"expo-google-app-auth\";\nimport AsyncStorage from \"@react-native-community/async-storage\";\n\nconst provider = new firebase.auth.GoogleAuthProvider();\n\nconst AuthForm = () => {\n  const [email, setEmail] = useState(\"\");\n  const [pass, setPass] = useState(\"\");\n  const [err, setError] = useState(null);\n  const [test, setTest] = useState(false);\n  const [userStore, setUserStore] = useState(null);\n  const dispatch = useDispatch();\n\n  const save = async (user) => {\n    try {\n      const objectValue = JSON.stringify(user);\n      await AsyncStorage.setItem(\"user\", objectValue);\n    } catch (e) {\n      const error = new Error(e);\n      setError(error.message);\n    }\n  };\n\n  const remove = async () => {\n    try {\n      await AsyncStorage.removeItem(\"user\");\n    } catch (e) {\n      const error = new Error(e);\n      setError(error.message);\n    } finally {\n      setUserStore(\"\");\n    }\n  };\n\n  const Login = async () => {\n    try {\n      const user = await firebase\n        .auth()\n        .signInWithEmailAndPassword(email, pass)\n        // .then((info) => {\n        //  const user =  await firebase.firestore().collection('users').doc(info.user.uid).update({\n        //     email: info.user.email == null ? '' : info.user.email,\n        //     displayName: info.user.displayName == null ? '' : info.user.displayName,\n        //     photoURL: info.user.photoURL == null ? '' : info.user.photoURL,\n        //     phoneNumber: info.user.phoneNumber == null ? '' : info.user.phoneNumber,\n        //     emailVerified: info.user.emailVerified == null ? '' : info.user.emailVerified,\n        //   })\n        //   console.log('UPDATED USER ?????????',user);\n        //   save(user)\n        // })\n        // console.log(\"!!39*389842839353573258!!!!!>>>>>>\",user);\n      const uid = await firebase.auth().currentUser.uid;\n      const us = await firebase.auth().currentUser\n      // console.log(\"USSSSS>>>>> ??????>>>>>> TYTA\", us);\n      await firebase\n        .firestore()\n        .collection(\"users\")\n        .doc(uid)\n        .get()\n        .then((info) => save(info.data()));\n      setEmail(\"\");\n      setPass(\"\");\n      setTest(true);\n      // setUserStore(currentUser)\n      dispatch(userAuth(true));\n      // save(currentUser); // asyncStorage\n    } catch (err) {\n      const error = new Error(err);\n      setError(error.message);\n    }\n  };\n\n  const logout = async () => {\n    dispatch(deleteUser());\n    remove();\n    await firebase.auth().signOut();\n    const user = firebase.auth().currentUser;\n    return user ? console.log(\"logout\", user) : console.log(\"signOut\");\n  };\n\n  const onSignIn = (googleUser) => {\n    const unsubscribe = firebase\n      .auth()\n      .onAuthStateChanged(function (firebaseUser) {\n        unsubscribe();\n        if (!isUserEqual(googleUser, firebaseUser)) {\n          const credential = firebase.auth.GoogleAuthProvider.credential(\n            googleUser.idToken,\n            googleUser.accessToken\n          );\n          firebase\n            .auth()\n            .signInWithCredential(credential)\n            .then(async function (user) {\n              if (user.additionalUserInfo.isNewUser) {\n                console.log(\"USER>>>>>>>> true\", user.additionalUserInfo.isNewUser);\n                const userAuth = user.user;\n                await firebase\n                  .firestore()\n                  .collection(\"users\")\n                  .doc(user.user.uid)\n                  .set({\n                    email: userAuth.email == null ? \"\" : userAuth.email,\n                    displayName:\n                      userAuth.displayName == null ? \"\" : userAuth.displayName,\n                    phoneNumber:\n                      userAuth.phoneNumber == null ? \"\" : userAuth.phoneNumber,\n                    photoURL:\n                      userAuth.photoURL == null ? \"\" : userAuth.photoURL,\n                    emailVerified:\n                      userAuth.emailVerified == null\n                        ? \"\"\n                        : userAuth.emailVerified,\n                    // habits: [],\n                    // level: 1,\n                  });\n                await firebase\n                  .firestore()\n                  .collection(\"users\")\n                  .doc(user.user.uid)\n                  .get()\n                  .then((info) => save(info.data()));\n              } else {\n                console.log(\"USER>>>>>>>> false\", user.additionalUserInfo.isNewUser);\n                const userAuth = user.user;\n                await firebase\n                  .firestore()\n                  .collection(\"users\")\n                  .doc(user.user.uid)\n                  .update({\n                    email: userAuth.email == null ? \"\" : userAuth.email,\n                    displayName:\n                      userAuth.displayName == null ? \"\" : userAuth.displayName,\n                    phoneNumber:\n                      userAuth.phoneNumber == null ? \"\" : userAuth.phoneNumber,\n                    photoURL:\n                      userAuth.photoURL == null ? \"\" : userAuth.photoURL,\n                    emailVerified:\n                      userAuth.emailVerified == null\n                        ? \"\"\n                        : userAuth.emailVerified,\n                    // habits: [],\n                    // level: 1,\n                  });\n                await firebase\n                  .firestore()\n                  .collection(\"users\")\n                  .doc(user.user.uid)\n                  .get()\n                  .then((info) => save(info.data()));\n              }\n            })\n            .catch(function (error) {\n              const errorCode = error.code;\n              errorCode ? setError(errorCode) : null;\n              const errorMessage = error.message;\n              errorCode ? setError(errorMessage) : null;\n              const email = error.email;\n              errorCode ? setError(email) : null;\n              const credential = error.credential;\n              errorCode ? setError(credential) : null;\n              console.log(errorCode);\n              console.log(errorMessage);\n              console.log(email);\n              console.log(credential);\n            });\n        } else {\n          setError(\"User already signed-in Firebase.\");\n          console.log(\"User already signed-in Firebase.\");\n        }\n      });\n  };\n  //  DONT DELETE //\n  // console firebase id client old 331031432009-jd9240r775sse5hcm436i3l47r8pkeq7.apps.googleusercontent.com\n\n  const isUserEqual = (googleUser, firebaseUser) => {\n    if (firebaseUser) {\n      const providerData = firebaseUser.providerData;\n      for (let i = 0; i < providerData.length; i++) {\n        if (\n          providerData[i].providerId ===\n          firebase.auth.GoogleAuthProvider.PROVIDER_ID &&\n          providerData[i].uid === googleUser.getBasicProfile().getId()\n        ) {\n          return true;\n        }\n      }\n    }\n    return false;\n  };\n\n  async function signInWithGoogleAsync() {\n    try {\n      const result = await Google.logInAsync({\n        // androidClientId: YOUR_CLIENT_ID_HERE,\n        behavior: \"web\",\n        iosClientId:\n          \"531972357750-se0jv52p37gs986lcv4j8sma2crlom3i.apps.googleusercontent.com\",\n        scopes: [\"profile\", \"email\"],\n      });\n\n      if (result.type === \"success\") {\n        setError(null);\n        onSignIn(result);\n        setUserStore(result.user);\n        dispatch(userAuth(true));\n        // save(result.user)\n        return result.accessToken;\n      } else {\n        return setError(\"Something went wrong\");\n      }\n    } catch (e) {\n      const error = new Error(e);\n      return setError(error.message);\n    }\n  }\n\n  return (\n    <Layout\n      style={{ alignItems: \"center\", top: 250 }}\n      level=\"1\"\n    >\n      <Input\n        style={{ width: \"75%\" }}\n        placeholder=\"Email\"\n        value={email}\n        onChangeText={(nextValue) => setEmail(nextValue)}\n      />\n      <Input\n        style={{ width: \"75%\" }}\n        secureTextEntry={true}\n        placeholder=\"Password\"\n        value={pass}\n        onChangeText={(nextValue) => setPass(nextValue)}\n      />\n      <Button style={{ width: \"75%\", marginBottom: 5 }} onPress={Login}>\n        Sugn In\n      </Button>\n      <Button\n        style={{ width: \"75%\", marginBottom: 5 }}\n        onPress={() => signInWithGoogleAsync()}\n      >\n        Sign In With Google\n      </Button>\n      <Button style={{ width: \"75%\", marginBottom: 5 }} onPress={logout}>\n        Logout\n      </Button>\n      {test ? <TestDb /> : null}\n      {err ? <Text>{err}</Text> : null}\n    </Layout>\n  );\n};\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n});\n\nexport default AuthForm;\n"]},"metadata":{},"sourceType":"module"}